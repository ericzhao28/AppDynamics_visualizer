
<!doctype html>
<html>

<head>
    <title>Line Chart</title>
    <script src="
https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.6/Chart.bundle.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <style>
    canvas {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }
    </style>
</head>

<body>
    <div style="width:75%;">
        <canvas id="canvas"></canvas>
    </div>
    <br>
    <br>
    <button id="removeDataset">Remove Last Added Dataset</button>
		<button class="btn btn-primary" data-toggle="modal" data-target="#updateData">
		    Update data
		</button>

		<!-- Modal for adding updated information --> 
		<div class="modal fade" id="updateData" tabindex="-1" role="dialog" 
		     aria-labelledby="updateData" aria-hidden="true">
		    <div class="modal-dialog">
		        <div class="modal-content">
		          
		            <div class="modal-header">
		                <h4 class="modal-title" id="updateData">
		                    Update graph info
		                </h4>
		            </div>
		            <div class="modal-body">
	                <form role="form" id = "chartUpdateForm">
	                  <div class="form-group">
	                    <label for="startTimeInput">Authentication Key</label>
	                      <input type="text" class="form-control"
	                      id="startTimeInput" placeholder="{Date}T{Time}Z ex: 2016-06-30T06:08:53.766Z"/>
	                  </div>
                      <div class="form-group">
                        <label for="endTimeInput">Host Address</label>
                          <input type="text" class="form-control"
                          id="endTimeInput" placeholder="{Date}T{Time}Z ex: 2016-06-30T06:08:53.766Z"/>
                      </div>
                      <div class="form-group">
                        <label for="JSESSIONID">JSESSIONID</label>
                          <input type="text" class="form-control"
                          id="JSESSIONID" placeholder="JSESSIONID cookie value"/>
                      </div>
                      <div class="form-group">
                        <label for="XCSRF">XCSRF</label>
                          <input type="text" class="form-control"
                          id="XCSRF" placeholder="XCSRF cookie value"/>
                      </div>
                      <div class="form-group">
                        <label for="connectSID">connect.sid</label>
                          <input type="text" class="form-control"
                          id="connectSID" placeholder="connect.sid cookie value"/>
                      </div>
                     <div class="form-group">
                        <label for="ga">_ga Info</label>
                          <input type="text" class="form-control"
                          id="ga" placeholder="_ga cookie value"/>
                      </div>
                     <div class="form-group">
                        <label for="startTimeInput">Start time</label>
                          <input type="text" class="form-control"
                          id="startTimeInput" placeholder="Format: October 13, 2014 11:13:00"/>
                      </div>
                     <div class="form-group">
                        <label for="endTimeInput">End time</label>
                          <input type="text" class="form-control"
                          id="endTimeInput" placeholder="Format: October 13, 2014 11:13:00"/>
                      </div>
	                  <button type="submit" class="btn btn-default">Visualize</button>
	                </form>
		            </div>
		            
		         
		            <div class="modal-footer">
		                <button type="button" class="btn btn-default"
		                        data-dismiss="modal">
		                            Cancel
		                </button>
		            </div>
		        </div>
		    </div>
		</div>





    <script>
        // Generate random colors to make graph pretty
        var randomColorFactor = function() {
            return Math.round(Math.random() * 255);
        };
        var randomColor = function(opacity) {
            return 'rgba(' + randomColorFactor() + ',' + randomColorFactor() + ',' + randomColorFactor() + ',' + (opacity || '.3') + ')';
        };

        function updateChartData(e) {
        	e.preventDefault();
        	$.post('server', $('#chartUpdateForm').serialize(), function(dataJSON){
        		var updatedChartData = JSON.parse(dataJSON);

        		// Update dataset
      			var newDataset = {
                label: updateChartData.startTime + " to " + updatedChartData.endTime,
                borderColor: randomColor(0.4),
                backgroundColor: randomColor(0.5),
                pointBorderColor: randomColor(0.7),
                pointBackgroundColor: randomColor(0.5),
                pointBorderWidth: 1,
                data: updatedChartData.rawChartData
            };
            config.data.datasets.push(newDataset);

            // Update y axis
            var maxYValue = updatedChartData.suggestedMax;
            config.options.scales.yAxes[0].ticks.suggestedMax = maxYValue;
            
            window.myLine.update();
        	});
        }

        // Config for graph
        var config = {
            type: 'line',
            data: {
                labels: ["5", "10", "15", "20", "25", "30", "35", "40", "45", "50", "55", "60", "65", "70", "75", "80", "85", "90", "95", "100"],
                datasets: []
            },
            options: {
                responsive: true,
                title:{
                    display:true,
                    text:'Chart.js Line Chart'
                },
                tooltips: {
                    mode: 'label',
                    callbacks: {
                    }
                },
                hover: {
                    mode: 'dataset'
                },
                scales: {
                    xAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Percentage of time elapsed of time interval'
                        }
                    }],
                    yAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Traffic'
                        },
                        ticks: {
                            suggestedMin: 0,
                            suggestedMax: 250,
                        }
                    }]
                }
            }
        };

        // Update colors for each dataset 
        $.each(config.data.datasets, function(i, dataset) {
            dataset.borderColor = randomColor(0.4);
            dataset.backgroundColor = randomColor(0.5);
            dataset.pointBorderColor = randomColor(0.7);
            dataset.pointBackgroundColor = randomColor(0.5);
            dataset.pointBorderWidth = 1;
        });

        // Initializer
        window.onload = function() {
            var ctx = document.getElementById("canvas").getContext("2d");
            window.myLine = new Chart(ctx, config);
        };

        $('#removeDataset').click(function() {
            config.data.datasets.splice(0, 1);
            window.myLine.update();
        });

    </script>
</body>

</html>